<!DOCTYPE html>
<html lang="en"><head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W9G73E5P44"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W9G73E5P44');
</script>
          <link rel="icon" 
                type="image/png" 
                href="/docs/assets/images/dp_icon.png">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Categorical data | Data Perspectives</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Categorical data" />
<meta name="author" content="Stippe" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When two categories are not enough" />
<meta property="og:description" content="When two categories are not enough" />
<link rel="canonical" href="http://localhost:4000/categorical/" />
<meta property="og:url" content="http://localhost:4000/categorical/" />
<meta property="og:site_name" content="Data Perspectives" />
<meta property="og:image" content="http://localhost:4000/docs/assets/images/multinomial/survey1.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-16T00:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/docs/assets/images/multinomial/survey1.jpg" />
<meta property="twitter:title" content="Categorical data" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Stippe"},"dateModified":"2023-08-16T00:00:00+02:00","datePublished":"2023-08-16T00:00:00+02:00","description":"When two categories are not enough","headline":"Categorical data","image":"http://localhost:4000/docs/assets/images/multinomial/survey1.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/categorical/"},"url":"http://localhost:4000/categorical/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Data Perspectives" />

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>


<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>
</head>
<body><header class="site-header">

<div>
  <div class="wrapper" style="display:flex;"><a href="/"><img class="site-masthead" src="/docs/assets/images/logo_dp.png" alt="Data Perspectives" /></a><nav class="site-nav" style="display:flex;">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About me</a><a class="page-link" href="/index">Home</a><a class="page-link" href="/notes">List of the notes</a><a class="page-link" href="/links">Some useful resources</a></div>
      </nav></div>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Categorical data</h1>
    <p class="post-meta"><time class="dt-published" datetime="2023-08-16T00:00:00+02:00" itemprop="datePublished">
        Aug 16, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In a <a href="/count/">previous post</a> we saw how we can deal for categorical data when we have two categories.
In this post we will see how to extend the previous model when we have three or more categories
by using the <strong>multinomial</strong> distribution, which is the most generic distribution for a finite number of discrete categories,
and has as pmf:</p>

\[p(x | p) = \frac{n!}{x_1!x_2!...x_k!} p_1^{x_1} p_2^{x_2}...p_k^{k_k}\]

<p>where $k$ is the number of categories,</p>

\[n = \sum_{i=1}^k x_k\]

<p>and $p_i$ represents the probability that an object belongs to category $i$, so</p>

\[\sum_{i=1}^k p_k =1 \,.\]

<p>As a prior distribution one can use the <strong>Dirichlet</strong> distribution, which is the generalization of the Beta distribution:</p>

\[p(x | \alpha) = \frac{\Gamma(\alpha)}{\Gamma(\alpha_1)\Gamma(\alpha_2)...\Gamma(\alpha_k)} x_1^{\alpha_1-1} x_2^{\alpha_2-1}... x_k^{\alpha_k-1}\]

<p>where
\(\alpha = \sum_{i=1}^n \alpha_i\)
and $x$ is a vector belonging to the $p$ dimensional unit simplex:</p>

\[x_i &gt; 0\]

<p>and</p>

\[\sum_{i=1}^k x_i = 1\,.\]

<p>When $k=2$ we have that the Multinomial distribution corresponds to the Binomial distribution,
while the Dirichlet distribution corresponds to the Beta distribution.</p>

<p><img src="/docs/assets/images/multinomial/Dirichlet.png" alt="The Dirichlet distribution" /> The Dirichlet distribution</p>

<p><img src="/docs/assets/images/multinomial/Dirichlet1.png" alt="The Dirichlet distribution for different parameters" /> The Dirichlet distribution</p>

<p>It happened to me that, during a conference, we used a survey to understand how people got informed about the event.
Less than 50% of the audience answered to the survey, so I wanted to use a Multinomial-Dirichlet model to have an estimate about the uncertainties.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right"> </th>
      <th style="text-align: center">channel</th>
      <th style="text-align: center">number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0</td>
      <td style="text-align: center">friends</td>
      <td style="text-align: center">10</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: center">flyier</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: right">2</td>
      <td style="text-align: center">social</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: right"> </td>
      <td style="text-align: center"><strong>total</strong></td>
      <td style="text-align: center">17</td>
    </tr>
  </tbody>
</table>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">pymc</span> <span class="k">as</span> <span class="n">pm</span>
<span class="kn">import</span> <span class="n">arviz</span> <span class="k">as</span> <span class="n">az</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">pymc.sampling_jax</span> <span class="k">as</span> <span class="n">pmjax</span>

<span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">"</span><span class="s">seaborn-v0_8-darkgrid</span><span class="sh">"</span><span class="p">)</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">df_conf</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">channel</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">friends</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">flyier</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">social</span><span class="sh">'</span><span class="p">],</span> <span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]})</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">df_conf</span><span class="p">[</span><span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span>

<span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">multinomial</span><span class="p">:</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Dirichlet</span><span class="p">(</span><span class="sh">'</span><span class="s">theta</span><span class="sh">'</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nf">len</span><span class="p">(</span><span class="n">df_conf</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Multinomial</span><span class="p">(</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">df_conf</span><span class="p">[</span><span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">trace_multi</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">az</span><span class="p">.</span><span class="nf">plot_trace</span><span class="p">(</span><span class="n">trace_multi</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/multinomial/dirmulti_trace.png" alt="The trace of our model" /></p>

<p>Our trace looks good, so let us take a closer look to our parameter estimate:</p>

<p><img src="/docs/assets/images/multinomial/forest.png" alt="Our estimates for the probabilities" /></p>

<p>Of course, we do expect a high (negative) correlation between the coefficients, as the three components of $\theta$ must sum up to one,
so in order to better understand the posterior it is more appropriate to use a kernel density estimate:</p>

<p><img src="/docs/assets/images/multinomial/kde_plot.png" alt="The KDE plot of the posterior" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">az</span><span class="p">.</span><span class="nf">summary</span><span class="p">(</span><span class="n">trace_multi</span><span class="p">)</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right">mean</th>
      <th style="text-align: right">sd</th>
      <th style="text-align: right">hdi_3%</th>
      <th style="text-align: right">hdi_97%</th>
      <th style="text-align: right">mcse_mean</th>
      <th style="text-align: right">mcse_sd</th>
      <th style="text-align: right">ess_bulk</th>
      <th style="text-align: right">ess_tail</th>
      <th style="text-align: right">r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">theta[0]</td>
      <td style="text-align: right">0.549</td>
      <td style="text-align: right">0.11</td>
      <td style="text-align: right">0.341</td>
      <td style="text-align: right">0.748</td>
      <td style="text-align: right">0.002</td>
      <td style="text-align: right">0.001</td>
      <td style="text-align: right">4271</td>
      <td style="text-align: right">4599</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">theta[1]</td>
      <td style="text-align: right">0.151</td>
      <td style="text-align: right">0.081</td>
      <td style="text-align: right">0.026</td>
      <td style="text-align: right">0.303</td>
      <td style="text-align: right">0.001</td>
      <td style="text-align: right">0.001</td>
      <td style="text-align: right">3254</td>
      <td style="text-align: right">3801</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">theta[2]</td>
      <td style="text-align: right">0.3</td>
      <td style="text-align: right">0.099</td>
      <td style="text-align: right">0.124</td>
      <td style="text-align: right">0.49</td>
      <td style="text-align: right">0.001</td>
      <td style="text-align: right">0.001</td>
      <td style="text-align: right">7308</td>
      <td style="text-align: right">6200</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<p>Thus, assuming that our sample is representative of our population (those who came to our conference)
and that people honestly filled the form we can say that it’s likely that
more than the 50% of the people got informed about the event thanks to some friend, while roughly the 30% 
of the audience read about the event on some social.
Another issue of this model is that we are assuming that each answer is independent on the other answers,
while usually people goes to this kind of event in groups, but for my purpose it was sufficient
to have a rough idea of the underlying distribution.</p>

<p>You could be suspicious about the fact that the distribution for the flyer is so skewed.
In this case I reccomend you to perform a sensitivity analysis: try with $\alpha = (2, 2, 2)$,
as you will see the result won’t change much.</p>

<p>Notice that our sample is quite small, so any frequentist approach based on a
large-sample approximation would be simply wrong.
However, since we are doing Bayesian statistics, we don’t have to bother about
the sample size in order for our analysis to be internally consistent
(while of course any attempt to generalize
the result of the model from our sample to the entire population
should be carefully discussed).</p>

<h2 id="conclusions-and-take-home-message">Conclusions and take-home message</h2>
<ul>
  <li>Each time you face a new problem, think about the constraints you should put to your model. You should always implement all the relevant constraints in order not to allow for too much freedom.</li>
  <li>Building a model is just one step in making inference. Think about the limitations of your model, and what are the major problems in extending your results from the sample to the population.</li>
  <li>By using Bayesian statistics, you can draw robust conclusions even if you have small sample.</li>
</ul>

<p>We will now introduce a slightly more theoretical topic, namely
<a href="/conjugate/">conjugate models</a>,
and we will see how we can leverage them
to constrain our models.</p>

  </div><a class="u-url" href="/categorical/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Stippe</li>
          <li><a class="u-email" href="mailto:smaurizio87@protonmail.com">smaurizio87@protonmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://twitter.com/SteffPy" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://stackoverflow.com/users/11065831/stefano" target="_blank" title="stackoverflow">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/thestippe/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>

