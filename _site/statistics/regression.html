<!DOCTYPE html>
<html lang="en"><head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W9G73E5P44"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W9G73E5P44');
</script>
          <link rel="icon" 
                type="image/png" 
                href="/docs/assets/images/dp_icon.png">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Introduction to the linear regression | Data Perspectives</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Introduction to the linear regression" />
<meta name="author" content="Data-perspectives" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Including dependence on external variables" />
<meta property="og:description" content="Including dependence on external variables" />
<link rel="canonical" href="http://localhost:4000/statistics/regression" />
<meta property="og:url" content="http://localhost:4000/statistics/regression" />
<meta property="og:site_name" content="Data Perspectives" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-03-03T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Introduction to the linear regression" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Data-perspectives"},"dateModified":"2024-03-03T00:00:00+00:00","datePublished":"2024-03-03T00:00:00+00:00","description":"Including dependence on external variables","headline":"Introduction to the linear regression","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/statistics/regression"},"url":"http://localhost:4000/statistics/regression"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Data Perspectives" />


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>


<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>
<a rel="me" href="https://vis.social/@thestippe" style="display: none;">Mastodon</a>
<link rel="manifest" href="manifest.json">
</head>
<body>

        <div id='upperBar'><header class="site-header">

        <div id='upperBarr'>
        <script src="https://d3js.org/d3.v7.js"></script>
                <div class="wrapper" style="display:flex;"><ul hidden='hidden' id="postList"><li>
                        Application of the Lotka-Volterra model;/statistics/lotka_volterra;1
                </li><li>
                        Differential equations;/statistics/ode;2
                </li><li>
                        MRP;/statistics/mrp;3
                </li><li>
                        Dirichlet Process Mixture Models;/statistics/dp;4
                </li><li>
                        Bayesian Additive Regression Trees;/statistics/bart;5
                </li><li>
                        Splines;/statistics/spline;6
                </li><li>
                        Gaussian processes regression;/statistics/gp_example;7
                </li><li>
                        Gaussian processes;/statistics/gp;8
                </li><li>
                        Nonparametric models;/statistics/nonparametric_intro;9
                </li><li>
                        Structural time series;/statistics/structural_time_series;10
                </li><li>
                        Time series;/statistics/time_series;11
                </li><li>
                        Synthetic control;/statistics/synthetic_control;12
                </li><li>
                        Regression discontinuity design;/statistics/rdd;13
                </li><li>
                        Difference in difference;/statistics/difference_in_differences;14
                </li><li>
                        Instrumental variable regression;/statistics/instrumental_variable;15
                </li><li>
                        Randomized controlled trials;/statistics/randomized;16
                </li><li>
                        Causal inference;/statistics/causal_intro;17
                </li><li>
                        Experiment analysis with many blocking variables;/statistics/experiment_design_cont;18
                </li><li>
                        Experiment analysis;/statistics/experiment_design;19
                </li><li>
                        Introduction to Extreme Values theory;/statistics/extreme_intro;20
                </li><li>
                        Application of survival analysis with discrete times;/statistics/survival_example_2;21
                </li><li>
                        Application of survival analysis 1;/statistics/survival_example;22
                </li><li>
                        Introduction to survival analysis;/statistics/survival_analysis;23
                </li><li>
                        Random models and mixed models;/statistics/random_models;24
                </li><li>
                        Hierarchical models and meta-analysis;/statistics/hierarchical_metaanalysis;25
                </li><li>
                        Hierarchical models;/statistics/hierarchical_models;26
                </li><li>
                        Poisson regression;/statistics/poisson_regression;27
                </li><li>
                        Logistic regression;/statistics/logistic_regression;28
                </li><li>
                        Robust linear regression;/statistics/robust_regression;29
                </li><li>
                        Multi-linear regression;/statistics/multivariate_regression;30
                </li><li>
                        Linear regression with binary input;/statistics/regression_binary_input;31
                </li><li>
                        Introduction to the linear regression;/statistics/regression;32
                </li><li>
                        Model comparison, cont.;/statistics/model_averaging_cont;33
                </li><li>
                        Model comparison;/statistics/model_averaging;34
                </li><li>
                        Re-parametrizing your model;/statistics/reparametrization;35
                </li><li>
                        Predictive checks;/statistics/predictive_checks;36
                </li><li>
                        Trace inspection;/statistics/trace_inspection;37
                </li><li>
                        Introduction to the Bayesian workflow;/statistics/bayesian_workflow;38
                </li><li>
                        Mixture models;/statistics/mixture;39
                </li><li>
                        Multidimensional distributions;/statistics/categories;40
                </li><li>
                        The Gaussian model;/statistics/reals;41
                </li><li>
                        The Negative Binomial model;/statistics/negbin;42
                </li><li>
                        The Poisson model;/statistics/poisson;43
                </li><li>
                        The Beta-Binomial model;/statistics/betabin;44
                </li><li>
                        Section introduction;/statistics/simple_models_intro;45
                </li><li>
                        Some notation about probability;/statistics/probability_reminder;46
                </li><li>
                        How does MCMC works;/statistics/mcmc_intro;47
                </li><li>
                        Introduction to Bayesian inference;/statistics/bayes_intro;48
                </li><li>
                        An overview to statistics;/statistics/preface;49
                </li><li>
                        The Gestalt principles;/dataviz/gestalt;50
                </li><li>
                        Design tricks;/dataviz/design-introduction;51
                </li><li>
                        How to choose a color map;/dataviz/palettes-introduction;52
                </li><li>
                        Introduction to color perception;/dataviz/color-introduction;53
                </li><li>
                        Drawing is redrawing;/dataviz/gender-economist;54
                </li><li>
                        Visual queries;/dataviz/visual-queries;55
                </li><li>
                        Channel effectiveness;/dataviz/effectiveness;56
                </li><li>
                        Evolutions of the line chart;/dataviz/linechart-evolution;57
                </li><li>
                        Beyond the 1D scatterplot;/dataviz/scatterplot-evolution;58
                </li><li>
                        Perception;/dataviz/perception;59
                </li><li>
                        Fundamental charts;/dataviz/fundamental-charts;60
                </li><li>
                        Marks and channels;/dataviz/marks-channels;61
                </li><li>
                        Data abstraction;/dataviz/data-types;62
                </li><li>
                        Data visualization;/dataviz/dataviz;63
                </li></ul>
                        <div style="display:flex">
                  <a href="/statistics/model_averaging_cont" class="prev">&#8249;</a>
                  
                                <a href="/"><img class="site-masthead" src="/docs/assets/images/logo_dp.png" alt="Data Perspectives" id="logo" /></a><div id='searchNav' style="flex;">
                                        <input type="search" id="search_0" class="searchBar" onkeydown="searchText()" placeholder="Search">
                                </div>

                                <div hidden='hidden' id="search_focus">0</div>



                        </div><nav class="site-nav" style="display:flex;">
                                <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                                <label for="nav-trigger">
                                        <span class="menu-icon">
                                                <svg viewBox="0 0 18 15" width="18px" height="15px">
                                                        <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                                                </svg>
                                        </span>
                                </label>

                                <div class="trigger"><a  class="page-link" href="/about">About me</a><a  class="page-link" href="/links">Resources</a>
                                <a href="/statistics/" class="page-link">Up</a>
                                
                                </div>
                        </nav>
                  <a href="/statistics/regression_binary_input" class="next">&#8250;</a>
                  
        </div>


        <script src="/docs/assets/javascript/search.js">
        </script>
                </div>

</header>
<div class="progress-container">
    <div class="progress-bar" id="myBar"></div>
    </div>
        </div>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
          <div id='topPage'></div>
        <a href='/index'>
<img src="/docs/assets/images/background_resized.webp" alt="backround" style="margin:auto;display:block;width:1200px">

</a>
    <h1 class="post-title p-name" itemprop="name headline">Introduction to the linear regression</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-03-03T00:00:00+00:00" itemprop="datePublished">
        Mar 3, 2024
      </time></p>
    <p class="post-meta"> Reading time: <span class="reading-time" title="Estimated read time">
  
  12&prime;
</span>
</p>
  </header>
  <br>

  <div class="post-content e-content" itemprop="articleBody">
    <p>So far we discussed how to model one variable. With this
post we will start a discussion on how to model the dependence of one
variable on other variables, named <strong>covariates</strong>, <strong>confounders</strong>, <strong>regressors</strong>,
<strong>predictors</strong>
or <strong>risk factors</strong> depending on the research area we are dealing with.</p>

<h2 id="regression">Regression</h2>

<p>In regression, we want to model the dependence of one variable
\(Y\) on one or more external variables \(X\).
In other words, we are trying to determine an $f$ such that</p>

\[Y_i = f(X_i, \theta) + \varepsilon_i\]

<p>where $\varepsilon_i$ is some random noise and $\theta$ represents a set of parameters.
In the case of regression, we are not interested in modelling $X_i$.
Notice that the distribution of the $Y_i$ is now different among
different elements, as the parameters are assumed to depend on $X_i\,.$
In other words, the $Y_i$ are no more identically distributed.
What we want to model is the <strong>statistical dependence</strong>, which is not an exact one, since
we assume that there is some noise which makes our dependence inaccurate.
This fact makes statistical dependence different from the mathematical dependence,
where the relation is exactly fulfilled.
We must also draw a distinction between statistical dependence and causal dependence,
since a common misconception is that finding a statistical dependence 
implies a causal relation between $X$ and $Y$.</p>

<div class="emphbox">
Causal inference requires much stronger
assumptions than statistical inference.
</div>

<p>We are only allowed to draw conclusions about causality
when these assumptions are satisfied, as we will discuss later in this blog.
Notice that referring to $X$ as the risk factor is usually done in the context
of causal inference, and we will therefore avoid this term for now.</p>

<p>As pointed out by John Carlin in <a href="https://arxiv.org/pdf/2309.06668.pdf">this paper</a>, there are two main purposes for regression
other than causal inference: we may either want to <strong>describe</strong> a relation between $X$ and $Y\,,$
or we may desire to use our model to <strong>predict</strong> the value of $Y$ one $X$ has been measured.</p>

<p>By Taylor expanding $f$ around $X=0$ we have that the simplest
dependence we can assume is</p>

\[Y_i = \theta_0 + \theta_1 X_i + \varepsilon_i\,,\]

<p>we are therefore assuming the <strong>additivity</strong> of $Y_i$ with respect to $X_i\,.$</p>

<p>The assumption which is by far the most common for $\varepsilon_i$ is</p>

\[\varepsilon_i \sim \mathcal{N}(0, \sigma)\]

<p>We are therefore assuming that the errors are normally distributed, and that the
variance is independent on $X_i\,.$
The constant variance assumption is named <strong>homoscedasticity</strong>,
while the condition of variable variance is named <strong>heteroskedasticity</strong>.</p>

<p>Let us now take a look at our parameters:</p>
<ul>
  <li>$\theta_1$ is the average $Y$ difference of two groups with $\Delta Y = 1\,.$</li>
  <li>$\theta_0$ is the intercept of the model. If our data includes $X=0$ we can interpret $\theta_0$ as the value of $Y$ when $X=0\,.$</li>
  <li>$\sigma$ is the average variance.</li>
</ul>

<h2 id="gdp-life-expectancy-relation">GDP-Life expectancy relation</h2>

<p>In order to understand our model, we will apply it to investigate the relation between the gross domestic product of
a country and its life expectancy.</p>

<p>First of all, let us import the relevant libraries.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="n">pm</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="n">az</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
<span class="kn">import</span> <span class="nn">io</span>
</code></pre></div></div>

<p>We can now download the GDP data from the IMF rest API as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://www.imf.org/external/datamapper/api/v1/NGDPDPC'</span><span class="p">)</span> <span class="k">as</span> <span class="n">gdp</span><span class="p">:</span>
    <span class="n">data_gdp</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">gdp</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>

<span class="n">dt</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">data_gdp</span><span class="p">[</span><span class="s">'values'</span><span class="p">][</span><span class="s">'NGDPDPC'</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s">'2021'</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_gdp</span><span class="p">[</span><span class="s">'values'</span><span class="p">][</span><span class="s">'NGDPDPC'</span><span class="p">]</span> <span class="k">if</span> <span class="s">'2021'</span> <span class="ow">in</span> <span class="n">data_gdp</span><span class="p">[</span><span class="s">'values'</span><span class="p">][</span><span class="s">'NGDPDPC'</span><span class="p">][</span><span class="n">key</span><span class="p">]}</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dt</span><span class="p">).</span><span class="n">transpose</span><span class="p">().</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">'gdp'</span><span class="p">})</span>

</code></pre></div></div>

<p>We also download the country names from the same API, and we combine the two tables</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://www.imf.org/external/datamapper/api/v1/countries'</span><span class="p">)</span> <span class="k">as</span> <span class="n">countries</span><span class="p">:</span>
    <span class="n">data_countries</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">countries</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>

<span class="n">df_countries</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">.</span><span class="n">from_dict</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">data_countries</span><span class="p">[</span><span class="s">'countries'</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s">'label'</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_countries</span><span class="p">[</span><span class="s">'countries'</span><span class="p">]}).</span><span class="n">transpose</span><span class="p">().</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">'name'</span><span class="p">})</span>

<span class="n">df_n</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_countries</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'inner'</span><span class="p">)</span>
</code></pre></div></div>

<p>The table containing the life expectancy can be downloaded from <a href="https://data.worldbank.org/indicator/SP.DYN.LE00.IN">this page of the World Bank website</a>.
Rather than clicking on the website, we will download it automatically as follows</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://api.worldbank.org/v2/en/indicator/SP.DYN.LE00.IN?downloadformat=csv'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">content</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">z</span><span class="p">.</span><span class="n">namelist</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'API'</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">z</span><span class="p">.</span><span class="n">extract</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">df_lifexp</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

</code></pre></div></div>

<p>We can now combine the two dataframes. We will stick to the year 2021, as it is the most recent year for
most of the countries.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_le</span> <span class="o">=</span> <span class="n">df_lifexp</span><span class="p">[[</span><span class="s">'Country Code'</span><span class="p">,</span> <span class="s">'2021'</span><span class="p">]].</span><span class="n">set_index</span><span class="p">(</span><span class="s">'Country Code'</span><span class="p">).</span><span class="n">dropna</span><span class="p">().</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'2021'</span><span class="p">:</span> <span class="s">'Life expectancy'</span><span class="p">})</span>

<span class="n">df_final</span> <span class="o">=</span> <span class="n">df_n</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_le</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'inner'</span><span class="p">)</span>

<span class="n">sns</span><span class="p">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df_final</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/regression/pairplot.webp" alt="The pairplot of our variables" /></p>

<p>There appears to be no linear relation between the two. However, by a suitable variable redefinition,
we can get linearity within a good approximation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_final</span><span class="p">[</span><span class="s">'log GDP'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_final</span><span class="p">[</span><span class="s">'gdp'</span><span class="p">])</span>

<span class="n">sns</span><span class="p">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df_final</span><span class="p">[[</span><span class="s">'log GDP'</span><span class="p">,</span> <span class="s">'Life expectancy'</span><span class="p">]])</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/regression/pairplot_log.webp" alt="The pairplot of our variables" /></p>

<p>The homoscedasticity only seems to hold approximately, as in the region with lower GDP the data shows
a larger variance with respect to countries with higher GDP.
For the sake of simplicity, we will stick to the constant variance assumption, and we will see how to deal
with heterogeneous variance in a future post.</p>

<p>Let us now set up our model</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">x_pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'alpha'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'beta'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s">'sigma'</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="n">df_final</span><span class="p">[</span><span class="s">'log GDP'</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">df_final</span><span class="p">[</span><span class="s">'Life expectancy'</span><span class="p">])</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'y_pred'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>  <span class="c1"># We want to get the error bands for all the values of x_pred
</span>
<span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">nuts_sampler</span><span class="o">=</span><span class="s">'numpyro'</span><span class="p">)</span>

<span class="n">az</span><span class="p">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s">'alpha'</span><span class="p">,</span> <span class="s">'beta'</span><span class="p">,</span> <span class="s">'sigma'</span><span class="p">])</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/regression/trace.webp" alt="The trace plot" /></p>

<p>The trace looks fine. We will directly check the posterior predictive distribution.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">ppc</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>

<span class="n">y_mean</span> <span class="o">=</span> <span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'y_pred'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_pred</span><span class="p">))).</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_low</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'y_pred'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_pred</span><span class="p">))),</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_high</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'y_pred'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_pred</span><span class="p">))),</span> <span class="mf">0.975</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">y_low</span><span class="p">,</span> <span class="n">y_high</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'lightgray'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pred</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'grey'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_final</span><span class="p">[</span><span class="s">'log GDP'</span><span class="p">],</span> <span class="n">df_final</span><span class="p">[</span><span class="s">'Life expectancy'</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">x_pred</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">x_pred</span><span class="p">)])</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Log GDP per Capita'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Life Expectancy 2021'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/regression/ppc.webp" alt="The posterior predictive" /></p>

<p>While our model correctly reproduces the relation between the GDP and the average life expectancy,
it fails to reproduce the observed variance, confirming that the homoscedasticity assumption is violated.</p>

<p>Let us now inspect which nations show the biggest error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">df_final</span><span class="p">[</span><span class="s">'Life expectancy'</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'alpha'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">df_final</span><span class="p">[</span><span class="s">'log GDP'</span><span class="p">]).</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div class="code">
NGA   -13.328530
<br />
SWZ   -12.201977
<br />
GNQ   -11.809278
<br />
NRU   -11.197007
<br />
NAM   -10.621142
<br />
dtype: float64
</div>

<p>The above nations are Nigeria, eSwatini, Equatorial Guinea, Nuaru and Nambia,
so it looks like our model fails to reproduce some
African and Oceania countries, which have an average life expectancy
much lower than non-African and non-Oceania countries with similar GDP.</p>

<p>Let us also check if the assumption about the normality of the deviation
from the average trend is fulfilled within a good approximation</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span>
<span class="p">(</span><span class="n">df_final</span><span class="p">[</span><span class="s">'Life expectancy'</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'alpha'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> 
 <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">df_final</span><span class="p">[</span><span class="s">'log GDP'</span><span class="p">]),</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Residuals histogram'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/regression/res_plot.webp" alt="The pairplot of our variables" /></p>

<p>It appears that the distribution of the residual is left skewed, so in order
to improve our model we could use a skewed distribution,
like the <a href="https://www.pymc.io/projects/docs/en/stable/api/distributions/generated/pymc.SkewNormal.html">Skewed Normal distribution</a> or the <a href="https://arxiv.org/pdf/2303.05615.pdf">Variance Gamma</a>
instead of a normal distribution.</p>

<p>This is however a somehow more advanced topic with respect to an introductory
post on linear regression, so we won’t implement these models here.</p>

<h2 id="conclusions">Conclusions</h2>

<p>We introduced the linear model, and we saw how to implement it
with an example.
As we will see in the future posts, the linear model is the 
starting point for almost any regression model.
We discussed the interpretation of the parameters and some
of the most relevant assumptions we made about data.</p>

<h2 id="suggested-readings">Suggested readings</h2>

<ul>
  <li><cite> Kutner, M. H., Nachtsheim, C., Neter, J. (2004). Applied linear regression models.UK: McGraw-Hill/Irwin. </cite></li>
  <li><cite> Gelman, A., Hill, J., Vehtari, A. (2020). Regression and Other Stories. India: Cambridge University Press. </cite></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">watermark</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">p</span> <span class="n">xarray</span><span class="p">,</span><span class="n">pytensor</span><span class="p">,</span><span class="n">numpyro</span><span class="p">,</span><span class="n">jax</span><span class="p">,</span><span class="n">jaxlib</span>
</code></pre></div></div>
<div class="code">
Last updated: Tue Jul 16 2024
<br />

<br />
Python implementation: CPython
<br />
Python version       : 3.12.4
<br />
IPython version      : 8.24.0
<br />

<br />
xarray  : 2024.5.0
<br />
pytensor: 2.20.0
<br />
numpyro : 0.15.0
<br />
jax     : 0.4.28
<br />
jaxlib  : 0.4.28
<br />

<br />
numpy     : 1.26.4
<br />
arviz     : 0.18.0
<br />
seaborn   : 0.13.2
<br />
pandas    : 2.2.2
<br />
requests  : 2.32.2
<br />
matplotlib: 3.9.0
<br />
json      : 2.0.9
<br />
pymc      : 5.15.0
<br />

<br />
Watermark: 2.4.3
<br />
</div>

  </div><a class="u-url" href="/statistics/regression" hidden></a>

  <div>
          
          
  </div>

  <br>
  <div id='autograph'>
          Stippe Mar 3, 2024

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>


  <div class="wrapper">
          <div class='footer-text'>
                  Opinions are mine, mistakes too, and if you find any feel free to report it via mail or via Twitter.
                  <br>
                  Most of the material in the statistics section is an adaptation to Python of some pre-existing model.
                  <br>
                  I have tried to provide the necessary credits, but if you think that a relevant contribution is missing, please let me know.
                  <br>
                  No AI were harmed in creating this blog.
                  <br>
                  This is a blog, not a bakery: there are no cookies here!
                  <br>
                  The top image has been generated with a modified version Dan Gries' code, available at <a href="http://rectangleworld.com/blog/archives/538">http://rectangleworld.com</a>.
          </div>
          <br>

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Data-perspectives</li>
          <li><a class="u-email" href="mailto:dataperspectivesblog@gmail.com">dataperspectivesblog@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://twitter.com/SteffPy" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://stackoverflow.com/users/11065831/stefano" target="_blank" title="stackoverflow">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/thestippe/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://vis.social/@thestippe" target="_blank" title="mastodon">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#mastodon"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

  <script src="/docs/assets/javascript/scroll.js">
  </script>

</html>

