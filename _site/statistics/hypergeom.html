<!DOCTYPE html>
<html lang="en"><head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W9G73E5P44"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W9G73E5P44');
</script>
          <link rel="icon" 
                type="image/png" 
                href="/docs/assets/images/dp_icon.png">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Bonus: counting animals in a park | Data Perspectives</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Bonus: counting animals in a park" />
<meta name="author" content="Data-perspectives" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The hypergeometric distribution and the capture-mark-recapture method" />
<meta property="og:description" content="The hypergeometric distribution and the capture-mark-recapture method" />
<link rel="canonical" href="http://localhost:4000/statistics/hypergeom" />
<meta property="og:url" content="http://localhost:4000/statistics/hypergeom" />
<meta property="og:site_name" content="Data Perspectives" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-08-14T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Bonus: counting animals in a park" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Data-perspectives"},"dateModified":"2024-08-14T00:00:00+00:00","datePublished":"2024-08-14T00:00:00+00:00","description":"The hypergeometric distribution and the capture-mark-recapture method","headline":"Bonus: counting animals in a park","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/statistics/hypergeom"},"url":"http://localhost:4000/statistics/hypergeom"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Data Perspectives" />


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>


<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>
<a rel="me" href="https://vis.social/@thestippe" style="display: none;">Mastodon</a>
<link rel="manifest" href="manifest.json">
</head>
<body>

        <div id='upperBar'><header class="site-header">

        <div id='upperBarr'>
        <script src="https://d3js.org/d3.v7.js"></script>
                <div class="wrapper" style="display:flex;">

                
                
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                    
                    
                    
                    
                    

        <ul hidden='hidden' id="postList"><li>
                        Poisson regression;/statistics/poisson_regression;1
                </li><li>
                        Logistic regression;/statistics/logistic_regression;2
                </li><li>
                        Robust linear regression;/statistics/robust_regression;3
                </li><li>
                        Multi-linear regression;/statistics/multivariate_regression;4
                </li><li>
                        Linear regression with binary input;/statistics/regression_binary_input;5
                </li><li>
                        Introduction to the linear regression;/statistics/regression;6
                </li><li>
                        Model comparison, cont.;/statistics/model_averaging_cont;7
                </li><li>
                        Model comparison;/statistics/model_averaging;8
                </li><li>
                        Re-parametrizing your model;/statistics/reparametrization;9
                </li><li>
                        Predictive checks;/statistics/predictive_checks;10
                </li><li>
                        Trace inspection;/statistics/trace_inspection;11
                </li><li>
                        Introduction to the Bayesian workflow;/statistics/bayesian_workflow;12
                </li><li>
                        Mixture models;/statistics/mixture;13
                </li><li>
                        Multidimensional distributions;/statistics/categories;14
                </li><li>
                        The Gaussian model;/statistics/reals;15
                </li><li>
                        Bonus: counting animals in a park;/statistics/hypergeom;16
                </li><li>
                        The Negative Binomial model;/statistics/negbin;17
                </li><li>
                        The Poisson model;/statistics/poisson;18
                </li><li>
                        The Beta-Binomial model;/statistics/betabin;19
                </li><li>
                        Section introduction;/statistics/simple_models_intro;20
                </li><li>
                        Some notation about probability;/statistics/probability_reminder;21
                </li><li>
                        How does MCMC works;/statistics/mcmc_intro;22
                </li><li>
                        Introduction to Bayesian inference;/statistics/bayes_intro;23
                </li><li>
                        An overview to statistics;/statistics/preface;24
                </li><li>
                        The Gestalt principles;/dataviz/gestalt;25
                </li><li>
                        Design tricks;/dataviz/design-introduction;26
                </li><li>
                        How to choose a color map;/dataviz/palettes-introduction;27
                </li><li>
                        Introduction to color perception;/dataviz/color-introduction;28
                </li><li>
                        Drawing is redrawing;/dataviz/gender-economist;29
                </li><li>
                        Visual queries;/dataviz/visual-queries;30
                </li><li>
                        Channel effectiveness;/dataviz/effectiveness;31
                </li><li>
                        Evolutions of the line chart;/dataviz/linechart-evolution;32
                </li><li>
                        Beyond the 1D scatterplot;/dataviz/scatterplot-evolution;33
                </li><li>
                        Perception;/dataviz/perception;34
                </li><li>
                        Fundamental charts;/dataviz/fundamental-charts;35
                </li><li>
                        Marks and channels;/dataviz/marks-channels;36
                </li><li>
                        Data abstraction;/dataviz/data-types;37
                </li><li>
                        Data visualization;/dataviz/dataviz;38
                </li></ul>
                        <div style="display:flex">
                  <a href="/statistics/negbin" class="prev">&#8249;</a>
                  
                                <a href="/"><img class="site-masthead" src="/docs/assets/images/logo_dp.png" alt="Data Perspectives" id="logo" /></a><div id='searchNav' style="flex;">
                                        <input type="search" id="search_0" class="searchBar" onkeydown="searchText()" placeholder="Search">
                                </div>

                                <div hidden='hidden' id="search_focus">0</div>



                        </div><nav class="site-nav" style="display:flex;">
                                <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                                <label for="nav-trigger">
                                        <span class="menu-icon">
                                                <svg viewBox="0 0 18 15" width="18px" height="15px">
                                                        <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                                                </svg>
                                        </span>
                                </label>

                                <div class="trigger"><a  class="page-link" href="/about">About me</a><a  class="page-link" href="/links">Resources</a>
                                <a href="/statistics/" class="page-link">Up</a>
                                
                                </div>
                        </nav>
                  <a href="/statistics/reals" class="next">&#8250;</a>
                  
        </div>


        <script src="/docs/assets/javascript/search.js">
        </script>
                </div>

</header>
<div class="progress-container">
    <div class="progress-bar" id="myBar"></div>
    </div>
        </div>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
          <div id='topPage'></div>
        <a href='/index'>
<img src="/docs/assets/images/background_resized.webp" alt="backround" style="margin:auto;display:block;width:1200px">

</a>
    <h1 class="post-title p-name" itemprop="name headline">Bonus: counting animals in a park</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-08-14T00:00:00+00:00" itemprop="datePublished">
        Aug 14, 2024
      </time></p>
    <p class="post-meta"> Reading time: <span class="reading-time" title="Estimated read time">
  
  4&prime;
</span>
</p>
  </header>
  <br>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In this post we will discuss a model which is quite unknown outside
from the ecological scientific community.
This model is used to estimate the number of individuals of a given specie.
When dealing with wild animals, a complete census of the number of individuals
is generally unfeasible, since wild animals are usually good at hiding.
However, this method allows you to estimate the total number of individuals.</p>

<h2 id="the-hypergeometric-distribution">The hypergeometric distribution</h2>

<p>Let us consider an urn containing $N$ balls. $n$ balls are red, while
$N-n$ balls are blue.
Let us now assume that we extract $K$ balls out of the urn <strong>without
re-introducing them in the urn</strong>.
What is the probability that we extract $k$ red balls?
We will associate the extraction of a red ball with a success (x=1)
while the extraction of a green ball will be associated with a failure (x=0).</p>

<p>The probability of $k$ successes out of $K$ samples is given by</p>

\[P(x=k | N, n, K) = \frac{\binom{n}{k} \binom{N-n}{K-k}}{\binom{N}{K}}\]

<h2 id="the-capture-mark-recapture-method">The capture-mark-recapture method</h2>

<p>Let us now assume that we must count the number of individual of a certain
specie into a park.
We go to the park, and we manage to capture $n$ individuals.
We then mark them, and re-introduce them into the park.</p>

<p>After some time, we get back to the park and randomly capture other $K$ individuals.
We observe that $k$ of the individuals are marked.
Assuming that the total number of individuals is unchanged, we can now
estimate the total number of individuals $N$,
since we know that the number of marked captured individuals $k$
is distributed according to the hypergeometric distribution.</p>

<p>In order to apply the above method, let us consider the saddleback experiment
discussed in <a href="https://www.doc.govt.nz/documents/science-and-technical/docts28a.pdf">this article</a>.
In the experiment, the authors
captured and marked 100 saddlebacks. After one week,
they captured 60 individuals, and 40 of them were marked.</p>

<p>We will perform a Bayesian estimate for the total number of individuals.
We will assume an uninformative prior for the total number of
individuals, namely a geometric distribution with $p=0.001$.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="n">pm</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="n">az</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">cmr_model</span><span class="p">:</span>
    <span class="n">nest</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Geometric</span><span class="p">(</span><span class="s">'nest'</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">HyperGeometric</span><span class="p">(</span><span class="s">'k'</span><span class="p">,</span>  <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">nest</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">40</span><span class="p">]))</span>
    <span class="n">idata</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>

<span class="n">az</span><span class="p">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/hypergeom/trace.webp" alt="" /></p>

<p>The trace seems ok, we can now compare our estimate with the one provided in the
article:</p>

\[N_{est} = \frac{n \times K}{k} = \frac{100 \times 60}{40}=150\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">az</span><span class="p">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mi">40</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'grey'</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">'--'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">idata</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'nest'</span><span class="p">].</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s">'draw'</span><span class="p">,</span> <span class="s">'chain'</span><span class="p">)).</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'grey'</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/hypergeom/estimate.webp" alt="" /></p>

<p>The classical estimate, of course, closely resembles our estimate. We can
however provide the full probability distribution of the number of individuals,
and our method can be easily extended to allow for migration, birth or death
of individuals.</p>

<h2 id="conclusions">Conclusions</h2>
<p>We introduced the hypergeometric distribution, and we have seen how
to use this distribution to estimate the number of individuals 
in a capture-mark-recapture experiment.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">watermark</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">p</span> <span class="n">xarray</span><span class="p">,</span><span class="n">pytensor</span>
</code></pre></div></div>

<div class="code">
Last updated: Wed Nov 20 2024
<br />

<br />
Python implementation: CPython
<br />
Python version       : 3.12.7
<br />
IPython version      : 8.24.0
<br />

<br />
xarray  : 2024.9.0
<br />
pytensor: 2.25.5
<br />

<br />
arviz     : 0.20.0
<br />
pymc      : 5.17.0
<br />
matplotlib: 3.9.2
<br />
numpy     : 1.26.4
<br />

<br />
Watermark: 2.4.3
<br />
</div>

  </div><a class="u-url" href="/statistics/hypergeom" hidden></a>

  <br>
  <div id='autograph'>
          Stippe Aug 14, 2024

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>


  <div class="wrapper">
          <div class='footer-text'>
                  Opinions are mine, mistakes too, and if you find any feel free to report it via mail or via Twitter.
                  <br>
                  Most of the material in the statistics section is an adaptation to Python of some pre-existing model.
                  <br>
                  I have tried to provide the necessary credits, but if you think that a relevant contribution is missing, please let me know.
                  <br>
                  No AI were harmed in creating this blog.
                  <br>
                  This is a blog, not a bakery: there are no cookies here!
                  <br>
                  The top image has been generated with a modified version Dan Gries' code, available at <a href="http://rectangleworld.com/blog/archives/538">http://rectangleworld.com</a>.
          </div>
          <br>

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Data-perspectives</li>
          <li><a class="u-email" href="mailto:dataperspectivesblog@gmail.com">dataperspectivesblog@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://twitter.com/SteffPy" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://stackoverflow.com/users/11065831/stefano" target="_blank" title="stackoverflow">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/thestippe/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://vis.social/@thestippe" target="_blank" title="mastodon">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#mastodon"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

  <script src="/docs/assets/javascript/scroll.js">
  </script>

</html>

