<!DOCTYPE html>
<html lang="en"><head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W9G73E5P44"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W9G73E5P44');
</script>
          <link rel="icon" 
                type="image/png" 
                href="/docs/assets/images/dp_icon.png">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Application of survival analysis 1 | Data Perspectives</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Application of survival analysis 1" />
<meta name="author" content="Data-perspectives" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Survival analysis with continouous time" />
<meta property="og:description" content="Survival analysis with continouous time" />
<link rel="canonical" href="http://localhost:4000/statistics/survival_example" />
<meta property="og:url" content="http://localhost:4000/statistics/survival_example" />
<meta property="og:site_name" content="Data Perspectives" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-02-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Application of survival analysis 1" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Data-perspectives"},"dateModified":"2024-02-01T00:00:00+00:00","datePublished":"2024-02-01T00:00:00+00:00","description":"Survival analysis with continouous time","headline":"Application of survival analysis 1","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/statistics/survival_example"},"url":"http://localhost:4000/statistics/survival_example"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Data Perspectives" />


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>


<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>
<a rel="me" href="https://vis.social/@thestippe" style="display: none;">Mastodon</a>
<link rel="manifest" href="manifest.json">
</head>
<body>

        <div id='upperBar'><header class="site-header">

        <div id='upperBarr'>
        <script src="https://d3js.org/d3.v7.js"></script>
                <div class="wrapper" style="display:flex;"><ul hidden='hidden' id="postList"><li>
                        Splines regression;/statistics/splines;1
                </li><li>
                        Introduction to non-parametric models;/statistics/nonparametric;2
                </li><li>
                        How does MCMC works;/statistics/mcmc_intro;3
                </li><li>
                        Introduction to bayesian statistics;/statistics/bayes_intro;4
                </li><li>
                        The autoregressive model;/statistics/autoregressive;5
                </li><li>
                        Introduction to time series modelling;/statistics/time_series;6
                </li><li>
                        Synthetic control;/statistics/synthetic_control;7
                </li><li>
                        Regression discontinuity ;/statistics/discontinuity_regression;8
                </li><li>
                        Difference in difference;/statistics/difference_in_differences;9
                </li><li>
                        Instrumental variable regression;/statistics/instrumental_variable;10
                </li><li>
                        Randomized controlled trials;/statistics/randomized;11
                </li><li>
                        Causal inference;/statistics/causal_intro;12
                </li><li>
                        Random models and mixed models;/statistics/random_models;13
                </li><li>
                        Introduction to Extreme Values theory;/statistics/extreme_intro;14
                </li><li>
                        Application of survival analysis 1;/statistics/survival_example;15
                </li><li>
                        Introduction to survival analysis;/statistics/survival_analysis;16
                </li><li>
                        Hierarchical models and meta-analysis;/statistics/hierarchical_metaanalysis;17
                </li><li>
                        Hierarchical models;/statistics/hierarchical_models;18
                </li><li>
                        Poisson regression;/statistics/poisson_regression;19
                </li><li>
                        Logistic regression;/statistics/logistic_regression;20
                </li><li>
                        Robust linear regression;/statistics/robust_regression;21
                </li><li>
                        Introduction to the linear regression;/statistics/regression;22
                </li><li>
                        Model comparison;/statistics/model_averaging;23
                </li><li>
                        Predictive checks;/statistics/predictive_checks;24
                </li><li>
                        Trace inspection;/statistics/trace_inspection;25
                </li><li>
                        Introduction to the Bayesian workflow;/statistics/bayesian_workflow;26
                </li><li>
                        Mixture models;/statistics/mixture;27
                </li><li>
                        Multidimensional distributions;/statistics/categories;28
                </li><li>
                        Exponential model, gaussian model and their evolutions;/statistics/reals;29
                </li><li>
                        The Negative Binomial model;/statistics/negbin;30
                </li><li>
                        The Poisson model;/statistics/poisson;31
                </li><li>
                        The Beta-Binomial model;/statistics/betabin;32
                </li><li>
                        Common continuous probabilities;/statistics/common_continuous_probabilities;33
                </li><li>
                        Common discrete probabilities;/statistics/common_discrete_probabilities;34
                </li><li>
                        Design tricks;/dataviz/design-introduction;35
                </li><li>
                        How to choose a color map;/dataviz/palettes-introduction;36
                </li><li>
                        Introduction to color perception;/dataviz/color-introduction;37
                </li><li>
                        Drawing is redrawing;/dataviz/gender-economist;38
                </li><li>
                        Visual queries;/dataviz/visual-queries;39
                </li><li>
                        The Gestalt principles;/dataviz/gestalt;40
                </li><li>
                        Channel effectiveness;/dataviz/effectiveness;41
                </li><li>
                        Evolutions of the line chart;/dataviz/linechart-evolution;42
                </li><li>
                        Beyond the 1D scatterplot;/dataviz/scatterplot-evolution;43
                </li><li>
                        Perception;/dataviz/perception;44
                </li><li>
                        Fundamental charts;/dataviz/fundamental-charts;45
                </li><li>
                        Marks and channels;/dataviz/marks-channels;46
                </li><li>
                        Data abstraction;/dataviz/data-types;47
                </li><li>
                        Data visualization;/dataviz/dataviz;48
                </li></ul>
                        <div style="display:flex">
                  <a href="/statistics/survival_analysis" class="prev">&#8249;</a>
                  
                                <a href="/"><img class="site-masthead" src="/docs/assets/images/logo_dp.png" alt="Data Perspectives" id="logo" /></a><div id='searchNav' style="flex;">
                                        <input type="search" id="search_0" class="searchBar" onkeydown="searchText()" placeholder="Search">
                                </div>

                                <div hidden='hidden' id="search_focus">0</div>



                        </div><nav class="site-nav" style="display:flex;">
                                <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                                <label for="nav-trigger">
                                        <span class="menu-icon">
                                                <svg viewBox="0 0 18 15" width="18px" height="15px">
                                                        <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                                                </svg>
                                        </span>
                                </label>

                                <div class="trigger"><a  class="page-link" href="/about">About me</a><a  class="page-link" href="/links">Resources</a>
                                <a href="/statistics/" class="page-link">Up</a>
                                
                                </div>
                        </nav>
                  <a href="/statistics/extreme_intro" class="next">&#8250;</a>
                  
        </div>


        <script src="/docs/assets/javascript/search.js">
        </script>
                </div>

</header>
<div class="progress-container">
    <div class="progress-bar" id="myBar"></div>
    </div>
        </div>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
          <div id='topPage'></div>
        <a href='/index'>
<img src="/docs/assets/images/background_resized.webp" alt="backround" style="margin:auto;display:block;width:1200px">

</a>
    <h1 class="post-title p-name" itemprop="name headline">Application of survival analysis 1</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-02-01T00:00:00+00:00" itemprop="datePublished">
        Feb 1, 2024
      </time></p>
    <p class="post-meta"> Reading time: <span class="reading-time" title="Estimated read time">
  
  9&prime;
</span>
</p>
  </header>
  <br>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In the previous post we introduced survival
analysis and we discussed how to correctly treat
censorship.
In this post we will see an application of survival analysis.</p>

<h2 id="the-study">The study</h2>
<p>In this post we will use the “E1684” melanoma dataset available in the SurvSet python package.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="n">pm</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="n">az</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">SurvSet.data</span> <span class="kn">import</span> <span class="n">SurvLoader</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">default_rng</span><span class="p">()</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">SurvLoader</span><span class="p">()</span>

<span class="n">df_melanoma</span><span class="p">,</span> <span class="n">ref_melanoma</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">ds_name</span> <span class="o">=</span> <span class="s">'e1684'</span><span class="p">).</span><span class="n">values</span><span class="p">()</span>

<span class="c1"># Dataset reference
</span>
<span class="n">ref_melanoma</span>
</code></pre></div></div>

<div class="code">
<a href="https://www.rdocumentation.org/packages/smcure/versions/2.0/topics/e1684">https://www.rdocumentation.org/packages/smcure/versions/2.0/topics/e1684</a>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_melanoma</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: right"> </th>
      <th style="text-align: right">pid</th>
      <th style="text-align: right">event</th>
      <th style="text-align: right">time</th>
      <th style="text-align: right">num_age</th>
      <th style="text-align: left">fac_sex</th>
      <th style="text-align: left">fac_trt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1.15068</td>
      <td style="text-align: right">-11.0359</td>
      <td style="text-align: left">M</td>
      <td style="text-align: left">IFN</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0.62466</td>
      <td style="text-align: right">-5.12904</td>
      <td style="text-align: left">M</td>
      <td style="text-align: left">IFN</td>
    </tr>
    <tr>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">1.89863</td>
      <td style="text-align: right">23.186</td>
      <td style="text-align: left">F</td>
      <td style="text-align: left">Control</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0.45479</td>
      <td style="text-align: right">11.1449</td>
      <td style="text-align: left">F</td>
      <td style="text-align: left">Control</td>
    </tr>
    <tr>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2.09041</td>
      <td style="text-align: right">-13.3208</td>
      <td style="text-align: left">M</td>
      <td style="text-align: left">Control</td>
    </tr>
  </tbody>
</table>

<p>There variable “time” is our regression variable, the “event” column indicates if
the event happened, and its value is 1 if the event happened (the patient died)
while it is 0 if the event is censored.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">df_melanoma</span><span class="p">)</span>
</code></pre></div></div>

<div class="code">
284
</div>

<p>Let us count how many entries are censored</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'event'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div></div>

<div class="code">
88
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>
</code></pre></div></div>
<div class="code">
9.64384
</div>

<h2 id="the-model">The model</h2>

<p>We will use a Weibull likelihood, which is a quite flexible distribution,
which allows for fat tails, and it should thereby be more robust than
a Gamma distribution.</p>

\[Y \sim \mathcal{Weibull}(\sigma, \lambda)\]

<p>The Weibull distribution has pdf</p>

\[p(x | \alpha, \beta) = \alpha \frac{x^{\alpha-1}}{\beta^\alpha} e^{-(x/\beta)^\alpha}\]

<p>Both the parameters must be positive, and the mean of the distribution is</p>

\[\mu = \beta \Gamma\left(1+\alpha^{-1}\right)\]

<p>We want to assess the effectiveness of the treatment. The first possibility
is to fit two different models, one per treatment. Another very common
possibility is to use the treatment as a regression variable, and we will
use this method.
We define the covariate</p>

\[x =
\begin{cases}
1 &amp; treatment=IFN\\
0 &amp; treatment=Control\\
\end{cases}\]

<p>and we assume</p>

\[\begin{align}
&amp;
\lambda = \exp\left(\beta_0 + \beta_1 x \right)
\\
&amp;
\sigma = \exp\left(\alpha \right)
\\
&amp;
\alpha, \beta_i \sim \mathcal{N}(0, 100)
\\
\end{align}\]

<p>In this way we ensure that both the parameters are positive,
and the priors are very uninformative.
Let us introduce the censoring variable</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'censoring'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'event'</span><span class="p">],</span> <span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">])]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'alpha'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'beta'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'trt'</span><span class="p">])</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Weibull</span><span class="p">.</span><span class="n">dist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">beta</span><span class="o">=</span><span class="n">lam</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Censored</span><span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'censoring'</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">])</span>
    
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">az</span><span class="p">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/trace.webp" alt="The trace of our model" /></p>

<h2 id="treatment-comparison">Treatment comparison</h2>

<p>By the above figure we observe that $\beta_1&gt;0\,,$
and this indicates that the test treatment is more effective than the control one.
This becomes clearer by showing the distribution of the mean $\mu$</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">mu0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'alpha'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>
<span class="n">mu1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'alpha'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu0</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Control'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'IFN'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/mean.webp" alt="The posterior for the parameter mu" /></p>

<p>The mean for the test treatment is typically higher for the test group
than for the control group, and the peak of the mean for the IFN
treatment is roughly twice than the one for the control treatment.</p>

<p>Let us also take a look at the survival function, which is simply</p>

\[S(t, \alpha, \beta) = e^{-(t/\beta)^\alpha}\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">alpha</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>

<span class="n">t_pl</span> <span class="o">=</span>  <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">s0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>

<span class="n">alph</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'alpha'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">b0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">s0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s0_low</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s0_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.975</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>

<span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s1_low</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s1_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.975</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Control'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s0_low</span><span class="p">,</span> <span class="n">s0_high</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'lightgray'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'IFN'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s1_low</span><span class="p">,</span> <span class="n">s1_high</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'green'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_pl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s">'S(t)'</span><span class="p">)</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/survival.webp" alt="The survival functions" /></p>

<p>We can safely conclude that, for the patients in this study, the IFN
treatment gives better results than the control one.</p>

<h2 id="conclusions">Conclusions</h2>

<p>We discussed an application of survival analysis with continuous time, we explained how
to include the regressor dependence in bayesian survival analysis
and we also introduced the Weibull distribution.</p>

<h2 id="suggested-readings">Suggested readings</h2>

<ul>
  <li><cite>Ibrahim, J. G., Chen, M., Sinha, D. (2013). Bayesian Survival Analysis. Switzerland: Springer New York.</cite></li>
</ul>

  </div><a class="u-url" href="/statistics/survival_example" hidden></a>

  <div>
          
          
  </div>

  <br>
  <div id='autograph'>
          Stippe Feb 1, 2024

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>


  <div class="wrapper">
          <div class='footer-text'>

                  No AI were harmed in creating this blog.
                  <br>
                  This is a blog, not a bakery: there are no cookies here!
                  <br>
                  The top image has been generated with a modified version Dan Gries' code, available at <a href="http://rectangleworld.com/blog/archives/538">http://rectangleworld.com</a>.
          </div>
          <br>

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Data-perspectives</li>
          <li><a class="u-email" href="mailto:dataperspectivesblog@gmail.com">dataperspectivesblog@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://twitter.com/SteffPy" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://stackoverflow.com/users/11065831/stefano" target="_blank" title="stackoverflow">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/thestippe/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://vis.social/@thestippe" target="_blank" title="mastodon">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#mastodon"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

  <script src="/docs/assets/javascript/scroll.js">
  </script>

</html>

