<p>In the previous post we introduced survival
analysis, and we discussed how to correctly treat
censorship.
In this post we will see an application of survival analysis.</p>

<h2 id="the-study">The study</h2>
<p>In this post we will use the “E1684” melanoma dataset available in the SurvSet python package.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="n">pm</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="n">az</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">SurvSet.data</span> <span class="kn">import</span> <span class="n">SurvLoader</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">gammaln</span>
<span class="kn">import</span> <span class="nn">pytensor</span> <span class="k">as</span> <span class="n">pt</span>
<span class="kn">from</span> <span class="nn">sksurv.nonparametric</span> <span class="kn">import</span> <span class="n">kaplan_meier_estimator</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">654321</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">SurvLoader</span><span class="p">()</span>

<span class="n">df_melanoma</span><span class="p">,</span> <span class="n">ref_melanoma</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">ds_name</span> <span class="o">=</span> <span class="s">'e1684'</span><span class="p">).</span><span class="n">values</span><span class="p">()</span>

<span class="c1"># Dataset reference
</span>
<span class="n">ref_melanoma</span>
</code></pre></div></div>

<div class="code">
<a href="https://www.rdocumentation.org/packages/smcure/versions/2.0/topics/e1684">https://www.rdocumentation.org/packages/smcure/versions/2.0/topics/e1684</a>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_melanoma</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: right"> </th>
      <th style="text-align: right">pid</th>
      <th style="text-align: right">event</th>
      <th style="text-align: right">time</th>
      <th style="text-align: right">num_age</th>
      <th style="text-align: left">fac_sex</th>
      <th style="text-align: left">fac_trt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1.15068</td>
      <td style="text-align: right">-11.0359</td>
      <td style="text-align: left">M</td>
      <td style="text-align: left">IFN</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0.62466</td>
      <td style="text-align: right">-5.12904</td>
      <td style="text-align: left">M</td>
      <td style="text-align: left">IFN</td>
    </tr>
    <tr>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">1.89863</td>
      <td style="text-align: right">23.186</td>
      <td style="text-align: left">F</td>
      <td style="text-align: left">Control</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0.45479</td>
      <td style="text-align: right">11.1449</td>
      <td style="text-align: left">F</td>
      <td style="text-align: left">Control</td>
    </tr>
    <tr>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2.09041</td>
      <td style="text-align: right">-13.3208</td>
      <td style="text-align: left">M</td>
      <td style="text-align: left">Control</td>
    </tr>
  </tbody>
</table>

<p>There variable “time” is our regression variable, the “event” column indicates if
the event happened, and its value is 1 if the event happened (the patient died)
while it is 0 if the event is censored.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">df_melanoma</span><span class="p">)</span>
</code></pre></div></div>

<div class="code">
284
</div>

<p>Let us count how many entries are censored</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'event'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div></div>

<div class="code">
88
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>
</code></pre></div></div>
<div class="code">
9.64384
</div>

<h2 id="the-models">The models</h2>

<p>We will try and fit two models:
first we will try with an Exponential likelihood,</p>

\[Y \sim \mathcal{Exponential}(\lambda)\]

<p>we will then try with a Weibull likelihood, which is a quite flexible distribution,
which allows for fatter tails, and it should thereby be more robust than
an exponential or a Gamma distribution.</p>

\[Y \sim \mathcal{Weibull}(\sigma, \lambda)\]

<p>The Weibull distribution has pdf</p>

\[p(x | \alpha, \lambda) = \alpha \frac{x^{\alpha-1}}{\lambda^\alpha} e^{-(x/\lambda)^\alpha}\]

<p>Notice that, often, the second parameter is named $\beta$,
but since we will use this method for another purpose, we will use $\lambda$
for the second parameter.
Both the parameters must be positive, and the mean of the distribution is</p>

\[\mu = \lambda \Gamma\left(1+\alpha^{-1}\right)\]

<p>We want to assess the effectiveness of the treatment. The first possibility
is to fit two different models, one per treatment. Another very common
possibility is to use the treatment as a regression variable, and we will
use this method.
We define the covariate</p>

\[x =
\begin{cases}
1 &amp; treatment=IFN\\
0 &amp; treatment=Control\\
\end{cases}\]

<p>and we assume</p>

\[\begin{align}
&amp;
\lambda = \exp\left(\beta_0 + \beta_1 x \right)
\\
&amp;
\sigma = \exp\left(\alpha \right)
\\
&amp;
\alpha, \beta_i \sim \mathcal{N}(0, 100)
\\
\end{align}\]

<p>In this way we ensure that both the parameters are positive,
and the priors are very uninformative.
Let us introduce the censoring variable</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'censoring'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'event'</span><span class="p">],</span> <span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">])]</span>
<span class="n">df_melanoma</span><span class="p">[</span><span class="s">'trt'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'fac_trt'</span><span class="p">]</span><span class="o">==</span><span class="s">'IFN'</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<p>We will first try with the exponential model,
as discussed in chapter 2 of “Bayesian Survival Analysis”</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">expon_model</span><span class="p">:</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'beta'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'trt'</span><span class="p">])</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Exponential</span><span class="p">.</span><span class="n">dist</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Censored</span><span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'censoring'</span><span class="p">],</span>
                    <span class="n">observed</span><span class="o">=</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">])</span>
    <span class="n">idata_expon</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s">'numpyro'</span><span class="p">,</span>
                           <span class="n">draws</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">az</span><span class="p">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">idata_expon</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/trace_expon.webp" alt="The trace of the exponential model model" /></p>

<p>The image is similar, but not identical to the one of the reference.
However, our model is identical to the one provided in the reference.
In order to check this, you can try and fit the following model:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">expon_model_check</span><span class="p">:</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'beta'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'trt'</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">logp</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nu</span><span class="o">*</span><span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="o">*</span><span class="n">lam</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Potential</span><span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="n">logp</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">df_melanoma</span><span class="p">[</span><span class="s">'event'</span><span class="p">].</span><span class="n">values</span><span class="p">,</span> <span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">].</span><span class="n">values</span><span class="p">))</span>

<span class="k">with</span> <span class="n">expon_model_check</span><span class="p">:</span>
    <span class="n">idata_check</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s">'numpyro'</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
</code></pre></div></div>

<p>The formula for the log-likelihood is the one provided in the reference.
If you try and fit the model, you will get exactly the same figure we obtained.
The reason for the different trace is, probably, that the samplers
improved quite a lot in more than 20 years, in fact our trace looks much
better than the one in the reference.</p>

<p>We will now improve our model and try with the Weibull model</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">weibull_model</span><span class="p">:</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'alpha'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Normal</span><span class="p">(</span><span class="s">'beta'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'trt'</span><span class="p">])</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Weibull</span><span class="p">.</span><span class="n">dist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">beta</span><span class="o">=</span><span class="n">lam</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Censored</span><span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'censoring'</span><span class="p">],</span>
                    <span class="n">observed</span><span class="o">=</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'time'</span><span class="p">])</span>

<span class="k">with</span> <span class="n">weibull_model</span><span class="p">:</span>
    <span class="n">idata_weibull</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s">'numpyro'</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">az</span><span class="p">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">idata_weibull</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/trace_weibull.webp" alt="The trace of the Weibull model model" /></p>

<p>As we discussed, when you have two nested model, it is generally better to
use the more general one.
We will however try and compare the models in order to see which is the more appropriate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">expon_model</span><span class="p">:</span>
    <span class="n">pm</span><span class="p">.</span><span class="n">compute_log_likelihood</span><span class="p">(</span><span class="n">idata_expon</span><span class="p">)</span>

<span class="k">with</span> <span class="n">weibull_model</span><span class="p">:</span>
    <span class="n">pm</span><span class="p">.</span><span class="n">compute_log_likelihood</span><span class="p">(</span><span class="n">idata_weibull</span><span class="p">)</span>

<span class="k">with</span> <span class="n">expon_model</span><span class="p">:</span>
    <span class="n">idata_expon</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">idata_expon</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">))</span>

<span class="k">with</span> <span class="n">weibull_model</span><span class="p">:</span>
    <span class="n">idata_weibull</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">idata_weibull</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">rng</span><span class="p">))</span>

<span class="n">df_compare</span> <span class="o">=</span> <span class="n">az</span><span class="p">.</span><span class="n">compare</span><span class="p">({</span><span class="s">'Exponential'</span><span class="p">:</span> <span class="n">idata_expon</span><span class="p">,</span> <span class="s">'Weibull'</span><span class="p">:</span> <span class="n">idata_weibull</span><span class="p">})</span>

<span class="n">az</span><span class="p">.</span><span class="n">plot_compare</span><span class="p">(</span><span class="n">df_compare</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/loo.webp" alt="The LOO model comparison" /></p>

<p>The Weibull model seems much more appropriate to describe the data,
we will therefore stick to it from now on.</p>

<h2 id="treatment-comparison">Treatment comparison</h2>

<p>By looking at the Weibull trace, we observe that $\beta_1&gt;0\,,$
and this indicates that the test treatment is more effective than the control one.
This becomes clearer by showing the distribution of the mean $\mu$</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">weibull_model</span><span class="p">:</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s">'mu0'</span><span class="p">,</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">tensor</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">alpha</span><span class="p">))))</span>
    <span class="n">mu1</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s">'mu1'</span><span class="p">,</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">tensor</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">alpha</span><span class="p">))))</span>

<span class="k">with</span> <span class="n">weibull_model</span><span class="p">:</span>
    <span class="n">idata_mu</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">idata_weibull</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s">'mu0'</span><span class="p">,</span> <span class="s">'mu1'</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">az</span><span class="p">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">idata_mu</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s">'posterior_predictive'</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="s">'mu0'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">az</span><span class="p">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">idata_mu</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s">'posterior_predictive'</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="s">'mu1'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">"$</span><span class="se">\\</span><span class="s">mu_0$"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">"$</span><span class="se">\\</span><span class="s">mu_1$"</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/mean_new.webp" alt="The posterior for the parameter mu" /></p>

<p>The mean for the test treatment is typically higher for the test group
than for the control group, and the peak of the mean for the IFN
treatment is roughly twice than the one for the control treatment.</p>

<p>Let us also take a look at the survival function, which is simply</p>

\[S(t, \alpha, \beta) = e^{-(t/\beta)^\alpha}\]

<p>We will also compare the survival function obtained from our model
with the Kaplan-Meier estimator of the survival function</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">df0</span> <span class="o">=</span> <span class="n">df_melanoma</span><span class="p">[</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'trt'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df_melanoma</span><span class="p">[</span><span class="n">df_melanoma</span><span class="p">[</span><span class="s">'trt'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>

<span class="n">time0</span><span class="p">,</span> <span class="n">survival_prob0</span><span class="p">,</span> <span class="n">conf_int0</span> <span class="o">=</span> <span class="n">kaplan_meier_estimator</span><span class="p">(</span>
    <span class="n">df0</span><span class="p">[</span><span class="s">"event"</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">df0</span><span class="p">[</span><span class="s">'time'</span><span class="p">],</span> <span class="n">conf_type</span><span class="o">=</span><span class="s">"log-log"</span>
<span class="p">)</span>

<span class="n">time1</span><span class="p">,</span> <span class="n">survival_prob1</span><span class="p">,</span> <span class="n">conf_int1</span> <span class="o">=</span> <span class="n">kaplan_meier_estimator</span><span class="p">(</span>
    <span class="n">df1</span><span class="p">[</span><span class="s">"event"</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">df1</span><span class="p">[</span><span class="s">'time'</span><span class="p">],</span> <span class="n">conf_type</span><span class="o">=</span><span class="s">"log-log"</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">alpha</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>

<span class="n">t_pl</span> <span class="o">=</span>  <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>

<span class="n">alph</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">idata_weibull</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'alpha'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">b0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">idata_weibull</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">idata_weibull</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">idata_weibull</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="s">'beta'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">s0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s0_low</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s0_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>

<span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s1_low</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">s1_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Control'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'C0'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s0_low</span><span class="p">,</span> <span class="n">s0_high</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'lightgray'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">step</span><span class="p">(</span><span class="n">time0</span><span class="p">,</span> <span class="n">survival_prob0</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s">"post"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'C0'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">step</span><span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">survival_prob1</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s">"post"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'C1'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'IFN'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'C1'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fill_between</span><span class="p">(</span><span class="n">time0</span><span class="p">,</span> <span class="n">conf_int0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">conf_int0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s">"post"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'C0'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">fill_between</span><span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">conf_int1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">conf_int1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s">"post"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'C1'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">s1_low</span><span class="p">,</span> <span class="n">s1_high</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'lightgray'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_pl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_pl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s">'$S_0(t)$'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s">'$S_1(t)$'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/survival.webp" alt="The survival functions" /></p>

<p>We can safely conclude that, for the patients in this study, the IFN
treatment gives better results than the control one.</p>

<p>Also the hazard function can be easily computed:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">t</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="n">t_pl</span> <span class="o">=</span>  <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>


<span class="n">h0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">h0_low</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">h0_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b0</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>

<span class="n">h1</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">h1_low</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>
<span class="n">h1_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alph</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pl</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">h0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Control'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">h0_low</span><span class="p">,</span> <span class="n">h0_high</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'lightgray'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'IFN'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_pl</span><span class="p">,</span> <span class="n">h1_low</span><span class="p">,</span> <span class="n">h1_high</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'green'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_pl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s">'h(t)'</span><span class="p">)</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/docs/assets/images/statistics/survival_melanoma/hazard.webp" alt="The hazard functions obtained from our model" /></p>

<h2 id="conclusions">Conclusions</h2>

<p>We discussed an application of survival analysis with continuous time, we explained how
to include the regressor dependence in bayesian survival analysis,
and we also introduced the Weibull distribution.</p>

<p>In the next post, we will discuss a more flexible way to estimate the
survival function.</p>

<h2 id="suggested-readings">Suggested readings</h2>

<ul>
  <li><cite>Ibrahim, J. G., Chen, M., Sinha, D. (2013). Bayesian Survival Analysis. Springer New York.</cite></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">watermark</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">p</span> <span class="n">xarray</span><span class="p">,</span><span class="n">numpyro</span><span class="p">,</span><span class="n">jax</span><span class="p">,</span><span class="n">jaxlib</span>
</code></pre></div></div>

<div class="code">
Last updated: Thu May 22 2025<br />
<br />
Python implementation: CPython<br />
Python version       : 3.12.8<br />
IPython version      : 8.31.0<br />
<br />
xarray : 2025.1.1<br />
numpyro: 0.16.1<br />
jax    : 0.5.0<br />
jaxlib : 0.5.0<br />
<br />
sksurv    : 0.24.1<br />
SurvSet   : 0.2.6<br />
arviz     : 0.21.0<br />
matplotlib: 3.10.1<br />
pandas    : 2.2.3<br />
pytensor  : 2.30.3<br />
pymc      : 5.22.0<br />
numpy     : 2.1.3<br />
<br />
Watermark: 2.5.0
</div>
