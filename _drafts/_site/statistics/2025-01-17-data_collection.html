<p>Now that you precisely stated the question you want to answer, you must choose how
to collect your data.</p>

<h2 id="study-types">Study types</h2>

<p>There are many kinds of studies and many study classifications.
One very broad distinction is between <strong>experimental</strong> studies and
<strong>observational</strong> studies.
In the first case you treat your units and measure the outcome,
in the latter you simply observe different populations and compare them.
Causal conclusions drawn from experiments are generally considered more valid
than the ones drawn from observational studies, but this is not always possible,
as an experimental study might imply some ethical or practical issues.</p>

<p>A more refined subdivision is both based on the randomization criterion
and on the fact that the researcher assigns the treatment.
We will stick
to the following naming convention:</p>

<table>
  <thead>
    <tr>
      <th>Treatment \ Randomization</th>
      <th>Randomized</th>
      <th>Not randomized</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Researcher assigns treatment</strong></td>
      <td>Randomized experiment</td>
      <td>Quasi-experiment</td>
    </tr>
    <tr>
      <td><strong>Researcher does not assign treatment</strong></td>
      <td>Natural experiment</td>
      <td>Observational study</td>
    </tr>
  </tbody>
</table>

<p>This classification is not universally accepted, so whenever
you read about quasi experiments and natural experiments, make sure
you understand what the author means by them.</p>

<h3 id="a-hopefully-clarifying-example">A (hopefully) clarifying example</h3>

<p>Let us try and clarify the above concept with an example, and
let’s assume that we want to assess if riding bike is more dangerous than
walking.</p>

<p>In a randomized experiment, we would recruit a group of people,
randomly divide them into two groups and let them travel either
by walking or by riding a bike, depending on the assigned group,
measuring the number of injured for each group.</p>

<p>In an observational study, we would simply collect the number of injured persons
while walking and compare them with the number of injured persons while
riding a bike. Of course, there might be tons of reasons why
we observe a different number of injuries in the two groups.
As an example, poorer people have a lower chance of having a bike,
and the economic status might be related with the degree of knowledge
of the traffic laws, so the number of injuries is confounded by
the economic status.</p>

<p>In a quasi-experimental design, we could recruit a group of people
and give them a bike. As control group, we could use people who enrolled
late in the experiment, and ask them not to use the bike.
In this case, the treatment is assigned by us (we are giving a bike),
but the control group is not randomly assigned.</p>

<p>A natural experiment would require an external event to occur in order to be feasible.
As an example, if today the major of a town forbids using the bike,
we could try and perform a natural experiment by comparing the change in number of injured
persons in that town with the number of injuries in a nearby town before and after
the introduction of the law.
Of course, we must also analyze the differences between the two towns,
and exclude the presence of any systematic effect which could invalidate
our result.
If we are confident enough that the residence town is a random variable,
then we can define our study as a natural experiment.</p>

<h3 id="further-classification-criteria">Further classification criteria</h3>

<p>A study is named <strong>census</strong> if is performed on the entire population,
while it is named <strong>survey</strong> when it’s performed on a subsample.
Studying the entire population is obviously better than only using a subsample,
but this often has many practical drawbacks, and surveys are often preferred
to censuses.
This naming is generally referred to questionnaire studies, but the same naming
can be also applied to any kind of study.</p>

<p>At the beginning, we will focus on experiments, and only in the future
we will discuss observational studies.
Experiments have a very long history, but the systematic study on the different
kinds of experiments began at the beginning of the 20th century thanks
to sir Ronald Fisher, one of the most influential statisticians
of the modern statistics, and probably the man who’s considered the
father of modern statistics by many researchers.</p>

<p>Most of the methods we will discuss here have been originally
proposed in <a href="https://home.iitk.ac.in/~shalab/anova/DOE-RAF.pdf">“The Design of Experiments”</a>,
a breakthrough textbook where the principles and methods of the design of experiments
are collected and explained in great detail.</p>

<h2 id="population-frame-and-sample">Population, frame and sample</h2>

<p>In any survey, once you defined the population, you must choose a sampling
frame, which will be the data source you will use to sample your units.
The sampling frame can be different from the population: there might be units
which does not belong to your population, missing units or duplicate units.
It is important to reduce this misalignment as much as possible in order
to have an unbiased estimate, and it’s also important to figure out
which are the possible source of misalignment and which are your strategies
to handle them.</p>

<p>As an example, if you are performing a study on the students of your school,
you might have sick students which will be missing from your frame
or visiting students which should not be included in your frame.</p>

<p>Once you choose your frame, you should draw a sample from it, and whenever
possible this should be randomly in order to avoid any source of bias.</p>

<svg width="350" height="300">
    <circle cx="190" cy="150" r="110" stroke-width="4" fill="blue" />  
    <circle cx="150" cy="150" r="110" stroke-width="4" fill="steelblue" />
    <circle cx="105" cy="150" r="40" stroke-width="3" fill="blueviolet" />
    <circle cx="190" cy="150" r="110" stroke="gray" stroke-width="3" fill="none" />
    <text x="80" y="150" fill="black">SAMPLE</text>
    <text x="170" y="150" fill="black">FRAME</text>
    <text x="245" y="90" fill="red">POPULATION</text>
</svg>

<h2 id="principle-of-doe">Principle of DOE</h2>

<p>As previously stated, for the moment we will stick to experimental studies.
The design of any experiment rely on three main principles:</p>
<ul>
  <li>Randomization</li>
  <li>Replication</li>
  <li>Blocking</li>
</ul>

<p>Randomization is a broad concept, and it is needed to eliminate
or at least reduce the possibility of a bias in the experiment.</p>

<p>Let us assume that you are studying two versions of the same ingredient
for a chemical process, and you first run 5 runs with version A,
you then run other 5 runs with version B.
Let us also imagine that, after each run, you clean your
instrumentation, but that a small amount of residual remains after each run,
negatively affecting the performances of the next runs.
This could impact your conclusions on the performances of version B.
It is therefore important to assign a random order to the testing order
of the 10 runs.</p>

<p>Randomization plays a central role when it comes to evaluate the validity of
a study.
A classical example is given by the Doll and Hill lung cancer study,
where the authors used an observational study to investigate the relationship
between tobacco usage and lung cancer.
The author concluded that there was a relationship between the phenomena,
but being not a randomized experiment, these conclusions has been criticized
for many years, since other factors could have induced this relationship.
As an example, some author suggested that the same genetic factor
was determining both the willing to smoke and the increased cancer risk.
If the same relationship between smoking and lung cancer
were observed in a randomized study, the genetic relationship would be excluded,
since the treatment assignment (smoke/don’t smoke) would be random, therefore
it must be independent on the genetics.</p>

<p>There is sometimes confusion between random assignment, random sampling
and randomization as generally meant in the design of experiment
field.
Random sampling means to randomly choose the study units
from the population, and as we will discuss later, this helps
in generalizing the study results from the sample to the population.
Random assignment is the procedure to randomly assign the unit
to one of the treatment group, and it’s a specific kind of randomization.
Finally, randomization is a broad concept which requires to randomly
choose any factor which might affect the outcome.
Examples are the treatment assignment, the treatment order or the 
assignment of any other factor which might be relevant.
Randomization is needed in order to reduce the probability
that any systematic effect which has not been accounted in the analysis
invalidates the conclusions of the study.</p>

<p>Since measurements might be affected by variations, it is important
to quantify the amount of variability and identifying its
sources, and replication is therefore needed.
Replication should not be confused with measurement repetition,
since in replication also the entire preparation procedure should
be repeated.</p>

<p><br /></p>

<blockquote>
  <p>“Block what you can, randomize what you cannot”</p>

  <p>George Box</p>
</blockquote>

<p><br /></p>

<p>Blocking is a related concept, and it consists in fixing all the quantities
which can affect the experiment result in order to reduce the variability
in the comparison.
As an example, if we are studying the effect of a therapy,
and we suspect that the sex might affect the effect, 
we might consider using sex as a blocking variable.</p>

<p>Unfortunately, statistics is not enough when we talk about experiment,
and the process under study should always be under control.
In the abstract example we made, the chemical residual caused a drift
in the performances, and this kind of issue should be always avoided.</p>

<h2 id="randomization">Randomization</h2>

<h3 id="simple-random-sampling">Simple random sampling</h3>

<p>There are many randomization methods, and now we will discuss
some of the simplest methods.
Let us assume you want to select $K$ units out of a group of $N$ individuals.
The simplest method is the <strong>simple random sampling with replacement</strong>,
and it consists into drawing $K$ independent numbers going from $0$ to $N-1$<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">K</span><span class="o">=</span><span class="mi">20</span>
<span class="n">N</span><span class="o">=</span><span class="mi">100</span>

<span class="n">srswr</span> <span class="o">=</span> <span class="n">rng</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">K</span><span class="p">)</span>
<span class="n">srswr</span>
</code></pre></div></div>
<div class="code">
array([ 8, 77, 65, 43, 43, 85,  8, 69, 20,  9, 52, 97, 73, 76, 71, 78, 51,
       12, 83, 45])
</div>

<p>This method is very easy to understand and explain. It has however
the drawback that the same unit might be selected more than once,
reducing the size of our sample.</p>

<p>Another easy-to-understand method is the toss of a coin (Bernoulli)
or the roll of a die (Categorical)
to decide to which group a unit will be assigned.
The above example could be reformulated by assigning to each individual
a probability of 0.2 to be selected</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bern</span> <span class="o">=</span> <span class="n">rng</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
<span class="n">bern</span>
</code></pre></div></div>

<div class="code">
array([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1])
</div>

<p>The main issue of this method is that the difference
between the size of the selected sample and the desired sample size (20)
might be large.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">smpl</span><span class="p">)</span>
</code></pre></div></div>

<div class="code">
15
</div>

<p>A better strategy is to use the <strong>simple random sample without replacement</strong>
which can be implemented by drawing a random number for each of the $N$
elements and selecting the $K$ smaller elements.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">srswor</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rng</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">))</span><span class="o">&lt;</span><span class="n">K</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">srswor</span>
</code></pre></div></div>
<div class="code">
array([0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0,
       0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0,
       1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0,
       0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,
       1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1])
</div>

<p>The above result is named mask, and it’s an array of size $N$ where
there is a 1 for each selected unit.
The above method can be immediately generalized to split $N$ units
into $n$ groups, we can therefore use it to randomly split the
sample into the different treatment groups.
Assuming that $N = K*n\,,$ we can in fact order the units
according to the random numbers and assign the units from the first
to the $K$-th to the first group, the units from the $K+1$-th
to the $2K$-th to the second group and so on.</p>

<h2 id="other-sampling-methods">Other sampling methods</h2>
<p>Sometimes it is more practical to first group units and then to
only select some of the groups, either by selecting all the units
in the groups or by sampling from them (two stage sampling).
As an example, if you need to perform a survey to students,
it might be cumbersome to randomly select 100 students from all the schools
into your city, and it might be more reasonable to only select 5 schools
and only select 20 students for each of the selected schools.
This method is named <strong>cluster sampling</strong>, and it was very popular
when face-to-face surveys were more common.
Now, thanks to the web surveys, this method is less used, but it might still
be useful.</p>

<p>The last method, and probably the one which ensure that your
sample is the more representative as possible, is the 
<strong>stratified sampling</strong>.
Let us assume that you want to perform a survey on 20 employees
of a company.</p>

<p>They are divided as follows:</p>

<table>
  <thead>
    <tr>
      <th>Occupation</th>
      <th>Gender</th>
      <th>Number</th>
      <th>Percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Secretary</td>
      <td>Male</td>
      <td>25</td>
      <td>10</td>
    </tr>
    <tr>
      <td>Secretary</td>
      <td>Female</td>
      <td>75</td>
      <td>30</td>
    </tr>
    <tr>
      <td>Worker</td>
      <td>Male</td>
      <td>100</td>
      <td>40</td>
    </tr>
    <tr>
      <td>Worker</td>
      <td>Female</td>
      <td>50</td>
      <td>20</td>
    </tr>
  </tbody>
</table>

<p>In order to perform a proportional stratified random sample,
you should simply sample the 10% of your 20 employees from the first
stratum (subgroup), the 30% of your 20 employees from the second
stratum, the 40% of your 20 employees from the second
stratum and the 20% of your 20 employees from the  last
stratum, so you should randomly choose 2 males secretaries,
6 female secretaries, 8 male workers and 4 female workers.</p>

<p>In order to perform an analysis on some data obtained from a stratified
random sample, we can compute the relevant variable for each stratum
and weight the result according to the stratum proportion.</p>

<p>This is not the only stratification scheme you might use.
Another common scheme is to sample the same number of units from each
stratum, and this would result in a smaller variance in the inference
of this stratum. This method has however worst performance
on any global (<em>i.e.</em> averaged over the strata) inference.</p>

<p>This is the simplest kind of stratified random sampling,
and more advanced methods are possible, but we won’t discuss them in this post.</p>

<h2 id="an-additional-warning">An additional warning</h2>

<p>Data collection is never a purely statistical question, and a strong
domain knowledge is often needed to properly perform this task.
It is therefore mandatory to collaborate with a domain expert
in order to avoid pitfalls in this phase, as no
statistical model can give you good results when the underlying data
is not good enough.
This principle is often stated as</p>

<div class="emphbox">
Garbage in, garbage out.
</div>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>We are still pythonists, aren’t we? <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
